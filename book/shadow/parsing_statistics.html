<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Parsing Statistics - Shadow Simulator</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Shadow Network Simulator</li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> Installation and Setup</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../shadow/supported_platforms.html"><strong aria-hidden="true">1.1.</strong> Supported Platforms</a></li><li class="chapter-item expanded "><a href="../shadow/install_dependencies.html"><strong aria-hidden="true">1.2.</strong> Dependencies</a></li><li class="chapter-item expanded "><a href="../shadow/install_shadow.html"><strong aria-hidden="true">1.3.</strong> Shadow</a></li><li class="chapter-item expanded "><a href="../shadow/system_configuration.html"><strong aria-hidden="true">1.4.</strong> System Configuration</a></li><li class="chapter-item expanded "><a href="../shadow/install_shadow_with_docker.html"><strong aria-hidden="true">1.5.</strong> (Experimental) Shadow with Docker</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> The Shadow Simulator</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../shadow/getting_started.html"><strong aria-hidden="true">2.1.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="../shadow/parsing_statistics.html" class="active"><strong aria-hidden="true">2.2.</strong> Parsing Statistics</a></li><li class="chapter-item expanded "><a href="../shadow/log_format.html"><strong aria-hidden="true">2.3.</strong> Log Format</a></li><li class="chapter-item expanded "><a href="../shadow/design_overview.html"><strong aria-hidden="true">2.4.</strong> Design Overview</a></li><li class="chapter-item expanded "><a href="../shadow/notes_and_faq.html"><strong aria-hidden="true">2.5.</strong> Notes and FAQs</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Simulation Customization</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../shadow/shadow_config.html"><strong aria-hidden="true">3.1.</strong> Shadow Configuration</a></li><li class="chapter-item expanded "><a href="../shadow/network_config.html"><strong aria-hidden="true">3.2.</strong> Network Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../shadow/network_graph_attributes.html"><strong aria-hidden="true">3.2.1.</strong> Graph Configuration</a></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Developer Guides</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../shadow/developer_guide.html"><strong aria-hidden="true">4.1.</strong> Debugging and Profiling</a></li><li class="chapter-item expanded "><a href="../shadow/ci.html"><strong aria-hidden="true">4.2.</strong> Continous Integration Tests</a></li><li class="chapter-item expanded "><a href="../shadow/using_recompiled_libc.html"><strong aria-hidden="true">4.3.</strong> Using a Recompiled Libc</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> The Shadow Project</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../shadow/contributing.html"><strong aria-hidden="true">5.1.</strong> Contributing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../shadow/coding_style.html"><strong aria-hidden="true">5.1.1.</strong> Coding Style</a></li><li class="chapter-item expanded "><a href="../shadow/pull_requests.html"><strong aria-hidden="true">5.1.2.</strong> Pull Requests</a></li></ol></li><li class="chapter-item expanded "><a href="../shadow/maintainer_playbook.html"><strong aria-hidden="true">5.2.</strong> Maintainer Playbook</a></li><li class="chapter-item expanded "><a href="../shadow/nsf_sponsorship.html"><strong aria-hidden="true">5.3.</strong> NSF Sponsorship</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">TGen Traffic Generator</li><li class="chapter-item expanded "><a href="../tgen/index.html"><strong aria-hidden="true">6.</strong> About</a></li><li class="chapter-item expanded "><a href="../tgen/TGen-Markov-Models.html"><strong aria-hidden="true">7.</strong> Markov Models</a></li><li class="chapter-item expanded "><a href="../tgen/TGen-Options.html"><strong aria-hidden="true">8.</strong> Options</a></li><li class="chapter-item expanded "><a href="../tgen/TGen-Overview.html"><strong aria-hidden="true">9.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../tgen/Tools-JSON-Format.html"><strong aria-hidden="true">10.</strong> JSON Format</a></li><li class="chapter-item expanded affix "><li class="part-title">Tor Network Simulation</li><li class="chapter-item expanded "><a href="../tornettools/index.html"><strong aria-hidden="true">11.</strong> TorNetTools</a></li><li class="chapter-item expanded "><a href="../oniontrace/index.html"><strong aria-hidden="true">12.</strong> OnionTrace</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Shadow Simulator</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/shadow" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="parsing-statistics"><a class="header" href="#parsing-statistics">Parsing Statistics</a></h1>
<p>Shadow logs simulator heartbeat messages that contain useful system information for each virtual node in the experiment. For example, Shadow logs the number of bytes sent/received, number of bytes allocated/deallocated, CPU usage, etc. You can parse these heartbeat log messages to get insight into the simulation. Details of these heartbeat messages can be found <a href="log_format.html#heartbeat-messages">here</a>.</p>
<h2 id="generating-traffic"><a class="header" href="#generating-traffic">Generating Traffic</a></h2>
<p>This example uses the <a href="https://github.com/shadow/tgen">TGen traffic generator</a> to generate network traffic between hosts, and then shows results from Shadow's heartbeat messages.</p>
<p>TGen is capable of modeling generic behaviors with an action-dependency graph in the standard GraphML format. If you don't have it installed, you can follow the <a href="https://github.com/shadow/tgen/#setup">instructions here</a>. The following example runs TGen with 10 clients that each download 10 files from a set of 5 servers over a simple network topology.</p>
<p><code>shadow.yaml</code>:</p>
<pre><code class="language-yaml">general:
  # stop after 1 simulated hour
  stop_time: 3600

network:
  graph:
    # use a built-in network graph containing
    # a single vertex with a bandwidth of 1 Gbit
    type: 1_gbit_switch

hosts:
  # a host with the hostname 'server'
  server:
    processes:
    - path: ~/.local/bin/tgen
      args: ../../../tgen.server.graphml.xml
      start_time: 1
  # a host with the hostname 'client'
  client:
    processes:
    - path: ~/.local/bin/tgen
      args: ../../../tgen.client.graphml.xml
      start_time: 2
</code></pre>
<p>TGen requires an action-dependency graph for the client and server. See the <a href="https://github.com/shadow/tgen/tree/main/doc">TGen documentation</a> for more information about customizing TGen behaviors.</p>
<p><code>tgen.server.graphml.xml</code>:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;graphml xmlns=&quot;http://graphml.graphdrawing.org/xmlns&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://graphml.graphdrawing.org/xmlns http://graphml.graphdrawing.org/xmlns/1.0/graphml.xsd&quot;&gt;
  &lt;key attr.name=&quot;serverport&quot; attr.type=&quot;string&quot; for=&quot;node&quot; id=&quot;d1&quot; /&gt;
  &lt;key attr.name=&quot;loglevel&quot; attr.type=&quot;string&quot; for=&quot;node&quot; id=&quot;d0&quot; /&gt;
  &lt;graph edgedefault=&quot;directed&quot;&gt;
    &lt;node id=&quot;start&quot;&gt;
      &lt;data key=&quot;d0&quot;&gt;info&lt;/data&gt;
      &lt;data key=&quot;d1&quot;&gt;8888&lt;/data&gt;
    &lt;/node&gt;
  &lt;/graph&gt;
&lt;/graphml&gt;
</code></pre>
<p><code>tgen.client.graphml.xml</code>:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;graphml xmlns=&quot;http://graphml.graphdrawing.org/xmlns&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://graphml.graphdrawing.org/xmlns http://graphml.graphdrawing.org/xmlns/1.0/graphml.xsd&quot;&gt;
  &lt;key attr.name=&quot;recvsize&quot; attr.type=&quot;string&quot; for=&quot;node&quot; id=&quot;d5&quot; /&gt;
  &lt;key attr.name=&quot;sendsize&quot; attr.type=&quot;string&quot; for=&quot;node&quot; id=&quot;d4&quot; /&gt;
  &lt;key attr.name=&quot;count&quot; attr.type=&quot;string&quot; for=&quot;node&quot; id=&quot;d3&quot; /&gt;
  &lt;key attr.name=&quot;time&quot; attr.type=&quot;string&quot; for=&quot;node&quot; id=&quot;d2&quot; /&gt;
  &lt;key attr.name=&quot;peers&quot; attr.type=&quot;string&quot; for=&quot;node&quot; id=&quot;d1&quot; /&gt;
  &lt;key attr.name=&quot;loglevel&quot; attr.type=&quot;string&quot; for=&quot;node&quot; id=&quot;d0&quot; /&gt;
  &lt;graph edgedefault=&quot;directed&quot;&gt;
    &lt;node id=&quot;start&quot;&gt;
      &lt;data key=&quot;d0&quot;&gt;info&lt;/data&gt;
      &lt;data key=&quot;d1&quot;&gt;server:8888&lt;/data&gt;
    &lt;/node&gt;
    &lt;node id=&quot;pause&quot;&gt;
      &lt;data key=&quot;d2&quot;&gt;1,2,3&lt;/data&gt;
    &lt;/node&gt;
    &lt;node id=&quot;end&quot;&gt;
      &lt;data key=&quot;d3&quot;&gt;100&lt;/data&gt;
    &lt;/node&gt;
    &lt;node id=&quot;stream&quot;&gt;
      &lt;data key=&quot;d4&quot;&gt;1 MiB&lt;/data&gt;
      &lt;data key=&quot;d5&quot;&gt;1 MiB&lt;/data&gt;
    &lt;/node&gt;
    &lt;edge source=&quot;start&quot; target=&quot;stream&quot; /&gt;
    &lt;edge source=&quot;pause&quot; target=&quot;start&quot; /&gt;
    &lt;edge source=&quot;end&quot; target=&quot;pause&quot; /&gt;
    &lt;edge source=&quot;stream&quot; target=&quot;end&quot; /&gt;
  &lt;/graph&gt;
&lt;/graphml&gt;
</code></pre>
<p>With those three files saved in the same directory, you can start a simulation. This example may take a few minutes.</p>
<pre><code class="language-bash"># delete any existing simulation data
rm -rf shadow.data
shadow shadow.yaml &gt; shadow.log
</code></pre>
<p>In the TGen process output, lines containing <code>stream-success</code> represent completed downloads and contain useful timing statistics. From these lines we should see that clients have completed a total of <strong>100</strong> streams:</p>
<pre><code class="language-bash">for d in shadow.data/hosts/client*; do grep &quot;stream-success&quot; ${d}/* ; done | tee clients.log | wc -l
</code></pre>
<p>We can also look at the transfers from the servers' perspective:</p>
<pre><code class="language-bash">for d in shadow.data/hosts/server*; do grep &quot;stream-success&quot; ${d}/* ; done | tee servers.log | wc -l
</code></pre>
<h2 id="parsing-and-plotting-results"><a class="header" href="#parsing-and-plotting-results">Parsing and Plotting Results</a></h2>
<p>Shadow includes some Python scripts that can parse important statistics from the Shadow log messages, including network throughput over time, client download statistics, and client load statistics, and then visualize the results. The following will parse and plot the output produced from the above experiment:</p>
<pre><code class="language-bash"># parse the shadow output file
src/tools/parse-shadow.py --help
src/tools/parse-shadow.py --prefix results shadow.log
# plot the results
src/tools/plot-shadow.py --help
src/tools/plot-shadow.py --data results &quot;example-plots&quot;
</code></pre>
<p>The <code>parse-*.py</code> scripts generate <code>stats.*.json.xz</code> files. The (heavily trimmed) contents of <code>stats.shadow.json</code> look like the following:</p>
<pre><code class="language-json">$ xzcat results/stats.shadow.json.xz
{
  &quot;nodes&quot;: {
    &quot;client:11.0.0.1&quot;: {
      &quot;recv&quot;: {
        &quot;bytes_control_header&quot;: {
          &quot;0&quot;: 0,
          &quot;1&quot;: 0,
          &quot;2&quot;: 0,
          ...
          &quot;3599&quot;: 0
        },
        &quot;bytes_control_header_retrans&quot;: { ... },
        &quot;bytes_data_header&quot;: { ... },
        &quot;bytes_data_header_retrans&quot;: { ... },
        &quot;bytes_data_payload&quot;: { ... },
        &quot;bytes_data_payload_retrans&quot;: { ... },
        &quot;bytes_total&quot;: { ... }
      },
      &quot;send&quot;: { ... }
    },
    &quot;server:11.0.0.2&quot;: { ... }
  },
  &quot;ticks&quot;: {
    &quot;2&quot;: {
      &quot;maxrss_gib&quot;: 0.162216,
      &quot;time_seconds&quot;: 0.070114
    },
    &quot;3&quot;: { ... },
    ...
    &quot;3599&quot;: { ... }
  }
}
</code></pre>
<p>The <code>plot-*.py</code> scripts generate graphs. Open the PDF file that was created to see the graphed results.</p>
<p>You can also parse and plot the TGen output using the <code>tgentools</code> program from the TGen repo. <a href="https://github.com/shadow/tgen/blob/main/doc/Tools-Setup.md">This page</a> describes how to get started.</p>
<h3 id="combining-simulation-data"><a class="header" href="#combining-simulation-data">Combining Simulation Data</a></h3>
<p>Consider a set of experiments where we would like to analyze the effect of changing our nodes' traffic queueing disciplines. We run the following 2 experiments:</p>
<pre><code class="language-bash"># delete any existing simulation data and post-processing
rm -rf shadow.data shadow.log qdisc-fifo.data qdisc-fifo.log qdisc-rr.data qdisc-rr.log
shadow --interface-qdisc fifo       --data-directory qdisc-fifo.data shadow.yaml &gt; qdisc-fifo.log
shadow --interface-qdisc roundrobin --data-directory qdisc-rr.data   shadow.yaml &gt; qdisc-rr.log
</code></pre>
<p>To parse these log files, we use the following scripts:</p>
<pre><code class="language-bash">src/tools/parse-shadow.py --prefix=qdisc-fifo.results qdisc-fifo.log
src/tools/parse-shadow.py --prefix=qdisc-rr.results   qdisc-rr.log
</code></pre>
<p>Each of the directories <code>qdisc-fifo.results/</code> and <code>qdisc-rr.results/</code> now contain data statistics files extracted from the log files. We can now combine and visualize these results with the <code>plot-shadow.py</code> script:</p>
<pre><code class="language-bash">src/tools/plot-shadow.py --prefix &quot;qdisc&quot; --data qdisc-fifo.results/ &quot;fifo&quot; --data qdisc-rr.results/ &quot;round-robin&quot;
</code></pre>
<p>Open the PDF file that was created to compare results from the experiments.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../shadow/getting_started.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../shadow/log_format.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../shadow/getting_started.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../shadow/log_format.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
